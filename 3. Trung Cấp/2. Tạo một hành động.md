
## **1. Má»¥c tiÃªu**

BÃ i nÃ y hÆ°á»›ng dáº«n báº¡n:

* Táº¡o má»™t **action** má»›i trong ROS 2.
* Hiá»ƒu **cáº¥u trÃºc file `.action`** (gá»“m request, result, feedback).
* Biáº¿t cÃ¡ch **cáº¥u hÃ¬nh CMakeLists.txt vÃ  package.xml** Ä‘á»ƒ ROS 2 sinh code tá»± Ä‘á»™ng.
* Kiá»ƒm tra xem action cÃ³ Ä‘Æ°á»£c build thÃ nh cÃ´ng hay chÆ°a.

---

## **2. Kiáº¿n thá»©c ná»n**

* Trong ROS 2, **action** lÃ  má»™t loáº¡i giao tiáº¿p *asynchronous* (khÃ´ng Ä‘á»“ng bá»™) giá»¯a **action client** vÃ  **action server**.
* KhÃ¡c vá»›i:

  * **topic** â†’ truyá»n dá»¯ liá»‡u liÃªn tá»¥c, 1 chiá»u.
  * **service** â†’ yÃªu cáº§u â€“ pháº£n há»“i *má»™t láº§n duy nháº¥t*.
  * **action** â†’ há»— trá»£ gá»­i yÃªu cáº§u (goal), nháº­n pháº£n há»“i cuá»‘i (result), vÃ  nháº­n feedback trong khi Ä‘ang xá»­ lÃ½.
* Má»—i **action** cÃ³ **3 pháº§n tÃ¡ch biá»‡t bá»Ÿi `---`**:

  1. **Request**: dá»¯ liá»‡u client gá»­i Ä‘á»ƒ báº¯t Ä‘áº§u goal.
  2. **Result**: dá»¯ liá»‡u server gá»­i khi goal hoÃ n táº¥t.
  3. **Feedback**: dá»¯ liá»‡u server gá»­i liÃªn tá»¥c Ä‘á»ƒ bÃ¡o tiáº¿n Ä‘á»™.

---

## **3. CÃ¡c bÆ°á»›c thá»±c hiá»‡n**

### **BÆ°á»›c 1 â€” Táº¡o package chá»©a interface**

Báº¡n cáº§n má»™t package chuyÃªn Ä‘á»ƒ lÆ°u trá»¯ Ä‘á»‹nh nghÄ©a interface (msg, srv, action).
VÃ­ dá»¥:

```bash
mkdir -p ~/ros2_ws/src
cd ~/ros2_ws/src
ros2 pkg create --license Apache-2.0 custom_action_interfaces
```

> Package nÃ y **chá»‰ chá»©a Ä‘á»‹nh nghÄ©a interface**, khÃ´ng chá»©a node cháº¡y.

---

### **BÆ°á»›c 2 â€” Táº¡o file `.action`**

1. VÃ o thÆ° má»¥c package:

```bash
cd custom_action_interfaces
mkdir action
```

2. Táº¡o file **`Fibonacci.action`**:

```bash
int32 order
---
int32[] sequence
---
int32[] partial_sequence
```

ğŸ“Œ Ã nghÄ©a:

* **Request** (`order`) â†’ client yÃªu cáº§u server tÃ­nh dÃ£y Fibonacci Ä‘áº¿n pháº§n tá»­ thá»© *order*.
* **Result** (`sequence`) â†’ toÃ n bá»™ dÃ£y Fibonacci khi hoÃ n thÃ nh.
* **Feedback** (`partial_sequence`) â†’ cÃ¡c pháº§n tá»­ Ä‘Ã£ tÃ­nh Ä‘Æ°á»£c á»Ÿ thá»i Ä‘iá»ƒm hiá»‡n táº¡i.

---

### **BÆ°á»›c 3 â€” Cáº¥u hÃ¬nh build**

Má»Ÿ **`CMakeLists.txt`** vÃ  **thÃªm trÆ°á»›c** `ament_package()`:

```cmake
find_package(rosidl_default_generators REQUIRED)

rosidl_generate_interfaces(${PROJECT_NAME}
  "action/Fibonacci.action"
)
```

Má»Ÿ **`package.xml`** vÃ  thÃªm:

```xml
<buildtool_depend>rosidl_default_generators</buildtool_depend>
<member_of_group>rosidl_interface_packages</member_of_group>
```

> `rosidl_generate_interfaces` sáº½ gá»i trÃ¬nh sinh mÃ£ (code generation pipeline) Ä‘á»ƒ táº¡o ra file header `.hpp` (C++) hoáº·c `.py` (Python) tá»« Ä‘á»‹nh nghÄ©a `.action`.

---

### **BÆ°á»›c 4 â€” Build package**

```bash
cd ~/ros2_ws
colcon build
```

* Sau khi build, action sáº½ cÃ³ tÃªn Ä‘áº§y Ä‘á»§:

  ```
  custom_action_interfaces/action/Fibonacci
  ```
* TÃªn nÃ y gá»“m: **tÃªn package** + `/action/` + **tÃªn action**.

---

### **BÆ°á»›c 5 â€” Kiá»ƒm tra action**

1. Source workspace:

```bash
source install/local_setup.bash
```

2. Kiá»ƒm tra:

```bash
ros2 interface show custom_action_interfaces/action/Fibonacci
```

Káº¿t quáº£ sáº½ in ra:

```text
int32 order
---
int32[] sequence
---
int32[] partial_sequence
```

---

## **4. TÃ³m táº¯t quy trÃ¬nh**

1. **Táº¡o package interface** (chá»©a file `.action`).
2. **Äá»‹nh nghÄ©a action** vá»›i 3 pháº§n: request, result, feedback.
3. **Khai bÃ¡o trong CMakeLists.txt vÃ  package.xml**.
4. **Build báº±ng colcon** Ä‘á»ƒ sinh code.
5. **Kiá»ƒm tra báº±ng `ros2 interface show`**.

---

## **5. HÃ¬nh minh há»a luá»“ng dá»¯ liá»‡u cá»§a action**

```
[Client] --(Goal Request)--> [Server]
[Client] <--(Feedback)------ [Server]
[Client] <--(Result)-------- [Server]
```

* Client gá»­i request â†’ Server xá»­ lÃ½.
* Server vá»«a gá»­i feedback liÃªn tá»¥c â†’ Khi xong, gá»­i result.

---
